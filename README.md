# 网格策略（半）自动下单
自动获取股票收盘价，依据网格策略，自动下单。



## 网格策略
网格表数据来源即来自网格策略来自公众号：[股市药丸](http://weixin.sogou.com/weixin?type=1&s_from=input&query=%E8%82%A1%E5%B8%82%E8%8D%AF%E4%B8%B8&ie=utf8&_sug_=y&_sug_type_=&w=01019900&sut=11768&sst0=1506520645458&lkt=7%2C1506520634975%2C1506520645356)，关注公众号回复关键字“**网格**”，可查看策略。

根据股市药丸的网格表数据，结合我自己计划投入的资金量，我做了适用自己的[网格模型](https://github.com/luyh/test_easytrade/blob/master/%E7%BD%91%E6%A0%BC%E6%A8%A1%E5%9E%8B.numbers)。

我资金量不大，每天要盯数据手工下单显得特别费劲，正好最近在研究API/量化交易，找到[github-easytrader](https://github.com/shidenggui/easytrader)适来A股交易的接口（我用的银河证券），于是开干。

目前实现三个网格策略（华宝油气162411，证券ETF512880，及创业板ETF159915）（半）自动下委托单。

所谓半自动，是还需要人工处理少许错误或核对下单结果，确保无误。

## 简化假设
- 网格一天只触发一次（当然这个前提不是每天都成立）

## Dependence:

- [easytrader](https://github.com/shidenggui/easytrader)：
在windows下安装银河客户端，配置帐号，实现自动化交易
- [easyquotation](https://github.com/shidenggui/easyquotation)：获取行情数据


## 开发思路
其实就是模拟人用网格策略下单的思路，每天用程序挂委托单：
1. 获取（录入）网格表
2. 设置交易量
2. 利用easyquotation获取行情，获取收盘价
3. 查找所在网格位置
4. 获取网格交易价
5. 调用easytrader实现下单

## 程序输出
```
读出数据data.json
载入网表
网格表:
     159915  162411  512880
0    1.951   0.840   1.295
1    1.900   0.816   1.263
2    1.850   0.793   1.233
3    1.801   0.771   1.203
4    1.754   0.749   1.173
5    1.708   0.728   1.145
6    1.663   0.708   1.117
7    1.619   0.688   1.089
8    1.576   0.668   1.063
9    1.535   0.649   1.037
10   1.495   0.631   1.012
11   1.455   0.613   0.987
12   1.417   0.596   0.963
13   1.380   0.579   0.939
14   1.344   0.563   0.917
15   1.308   0.547   0.894
16     NaN   0.532     NaN
17     NaN   0.517     NaN
18     NaN   0.502     NaN
19     NaN   0.488     NaN
20     NaN   0.474     NaN
行情:
      159915 162411 512880
name    创业板   华宝油气  证券ETF
now     1.8  0.599  1.066
high    1.8  0.599  1.072
low   1.775  0.598  1.056
读出数据pos.json
初始网格位置 {'162411': 12, '512880': 8, '159915': 3}
写入数据pos.json
调整网格位置 {'162411': 12, '512880': 8, '159915': 3}
交易量： {'162411': 300, '512880': 600, '159915': 200}
trade {'162411': {'buy': '0.579', 'sell': '0.613'}, '512880': {'buy': '1.037', 'sell': '1.089'}, '159915': {'buy': '1.754', 'sell': '1.850'}}
请检查客户端或easystockr设置
自动下单失灵，为下单，引入回车确认下单
加载win32api异常：ModuleNotFoundError: No module named 'win32api'
下单异常
```


## 遇到的问题
当然，在测试过程中我发现能录单，但不能确认订单（得手工确认），然后我找下用代码实现两次回车，模拟人工的确认订单。

还有个问题是：客户端打开时，需将交易面版还原。不然程序不会执行下单。

## 进一步完善
- 修复手工确认订单两次回车的问题，这样可返回交易单号。群友已给出解决方案，我还未测试验证。
- 如果能每天帮打新债就好了
- 这个只是个人的小工作，更合规的可能要用些交易框架，比如[easyquant](https://github.com/shidenggui/easyquant)
